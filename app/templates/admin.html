{% extends "layout_admin.html" %}

{% block title %}Adminbereich{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">👨‍🚒 Admin – Einladungen verwalten</h1>

{% if whatsapp_active %}
  <p class="mb-4 p-3 rounded bg-green-100 text-green-800">
    ✅ WhatsApp-Benachrichtigung ist aktiviert
  </p>
{% else %}
  <p class="mb-4 p-3 rounded bg-yellow-100 text-yellow-800">
    ⚠️ WhatsApp-Benachrichtigung ist derzeit deaktiviert
  </p>
{% endif %}

<form method="POST" action="{{ url_for('new_invite') }}" class="mb-8 bg-white p-6 rounded shadow">
  <h2 class="text-xl font-semibold mb-4">➕ Neue Einladung erstellen</h2>
  <div class="grid md:grid-cols-2 gap-4">
    <input type="text" name="verein" placeholder="Name der Feuerwehr" required class="p-2 border rounded w-full">
    <input type="text" name="adresse" maxlength="200" placeholder="Adresse (optional)" class="p-2 border rounded w-full">
  </div>
  <button type="submit" class="mt-4 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
    Einladung erstellen
  </button>
</form>

<div class="overflow-auto">
  <table class="w-full text-left bg-white rounded shadow">
    <thead class="bg-gray-200">
      <tr>
        <th class="p-3">Verein</th>
        <th class="p-3">Adresse</th>
        <th class="p-3">Link</th>
        <th class="p-3">QR-Code</th>
        <th class="p-3">Antwort</th>
        <th class="p-3">Personen</th>
        <th class="p-3">Getränke</th>
        <th class="p-3">Zuletzt aktualisiert</th>
      </tr>
    </thead>
    <tbody>
      {% for invite in invites %}
      <tr class="border-t">
        <td class="p-3 font-medium">{{ invite.verein }}</td>
        <td class="p-3">{{ invite.adresse }}</td>
        <td class="p-3 text-sm break-all">
          <a href="{{ invite.link }}" class="text-blue-600 underline" target="_blank">Link öffnen</a>
        </td>
        <td class="p-3">
          <img src="{{ url_for('static', filename=invite.qr_code_path.split('static/')[1]) }}" alt="QR" class="h-16">
        </td>
        {% set res = responses.get(invite.token) %}
        <td class="p-3">{{ res.attending if res else "-" }}</td>
        <td class="p-3">{{ res.persons if res else "-" }}</td>
        <td class="p-3 text-sm">{{ res.drinks if res else "-" }}</td>
        <td class="p-3 text-sm">
          {{ res.timestamp.strftime('%d.%m.%Y %H:%M') if res else "-" }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
